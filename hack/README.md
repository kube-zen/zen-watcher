# Zen Watcher - Scripts & Utilities

This directory contains helpful scripts for installing, testing, and managing Zen Watcher.

---

## üöÄ Quick Demo Script

### `quick-demo.sh`

**ONE COMMAND to set up a complete demo environment!**

```bash
./hack/quick-demo.sh [platform]
```

**Platforms**: `k3d` (default), `kind`, `minikube`

**What it does**:
1. Creates local cluster
2. Installs security tools (Trivy, Falco, Kyverno)
3. Deploys monitoring (VictoriaMetrics, Grafana)
4. Configures datasources automatically
5. Imports dashboard
6. Sets up port-forwards
7. **Optionally** deploys mock data (prompts user)

**Time**: ~5 minutes

**Access**:
- Grafana: http://localhost:3100
- Login: zen / `<auto-generated-password>`

---

## üìä Mock Data Script

### `mock-data.sh`

**Deploys mock zen-watcher with sample metrics.**

```bash
./hack/mock-data.sh [namespace]
```

**Default namespace**: `zen-system`

**What it does**:
- Deploys Python HTTP server serving Prometheus metrics
- Generates realistic sample data
- Makes dashboard show actual values

**Sample metrics**:
- Health status: 1 (healthy)
- Events: 5 CRITICAL, 23 HIGH, 45 MEDIUM
- Watchers: 5 active tools
- HTTP requests, memory, goroutines

**Use cases**:
1. **With quick-demo**: Shows working dashboard immediately
2. **Standalone**: Add mock data to existing cluster
3. **Testing**: Verify dashboard queries work

---

## üìã Usage Scenarios

### Scenario 1: Complete Demo (Infrastructure + Mock Data)

```bash
./hack/quick-demo.sh
# When prompted: Press 'y' for mock data
```

**Result**: Full demo with working dashboard showing data

---

### Scenario 2: Infrastructure Only

```bash
./hack/quick-demo.sh
# When prompted: Press 'n' to skip mock data
```

**Result**: Cluster with all tools, ready for real zen-watcher deployment

---

### Scenario 3: Add Mock Data to Existing Cluster

```bash
# Cluster already exists with Grafana/VictoriaMetrics
./hack/mock-data.sh zen-system
```

**Result**: Mock data added, dashboard shows metrics

---

### Scenario 4: Test Different Namespaces

```bash
# Deploy to production namespace
./hack/quick-demo.sh
# Press 'n' for no mock

# Later, add mock to test namespace  
./hack/mock-data.sh test-namespace
```

---

## üîß Smart Installer

### `install.sh`

**Intelligent production installation with auto-detection.**

```bash
./hack/install.sh [options]
```

**Features**:
- Auto-detects existing Prometheus/Grafana
- Auto-detects existing security tools
- Installs only what's missing
- Production-ready

**Options**:
```bash
--namespace NAME          # Target namespace
--skip-tools              # Don't install security tools
--skip-monitoring         # Don't install monitoring  
--use-prometheus URL      # Use existing Prometheus
--use-grafana URL         # Use existing Grafana
--dry-run                 # Show what would be installed
```

---

## üéØ Quick Reference

| Task | Command |
|------|---------|
| Full demo with data | `./hack/quick-demo.sh` ‚Üí Yes |
| Infrastructure only | `./hack/quick-demo.sh` ‚Üí No |
| Add mock data | `./hack/mock-data.sh` |
| Production install | `./hack/install.sh` |
| With existing tools | `./hack/install.sh --skip-tools` |
| Dry run | `./hack/install.sh --dry-run` |

---

## üß™ Testing

### Test Quick Demo
```bash
# Clean start
k3d cluster delete zen-demo
./hack/quick-demo.sh
```

### Test Mock Data Standalone
```bash
# Assume cluster exists
./hack/mock-data.sh zen-system

# Verify metrics
kubectl exec -n zen-system deployment/zen-watcher-mock -- \
  wget -qO- http://localhost:8080/metrics
```

### Test Smart Installer
```bash
./hack/install.sh --dry-run
./hack/install.sh --namespace test-zen
```

---

## üîç Troubleshooting

### Mock Data Issues

**Metrics not showing**:
```bash
# Check pod is running
kubectl get pods -n zen-system -l app=zen-watcher

# Test metrics endpoint
kubectl exec -n zen-system deployment/zen-watcher-mock -- \
  wget -qO- http://localhost:8080/metrics

# Check VictoriaMetrics scraping
kubectl logs -n zen-system -l app=victoriametrics | grep zen-watcher
```

**Port conflicts**:
```bash
# Use different ports
GRAFANA_PORT=3200 ./hack/quick-demo.sh
```

---

## üìö More Information

- **[Deployment Scenarios](../docs/DEPLOYMENT_SCENARIOS.md)** - Complete guide
- **[Quick Start](../QUICK_START.md)** - Manual steps
- **[Helm Chart](../charts/zen-watcher/README.md)** - Production deployment

---

**Make evaluation easy!** ‚ú®
