apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: observationdedupconfigs.zen.kube-zen.io
spec:
  group: zen.kube-zen.io
  names:
    kind: ObservationDedupConfig
    listKind: ObservationDedupConfigList
    plural: observationdedupconfigs
    singular: observationdedupconfig
    shortNames:
      - obsdedup
      - oddc
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              required: ["targetSource"]
              properties:
                targetSource:
                  type: string
                  description: "The source name this dedup configuration applies to (e.g., trivy, falco, kyverno, cert-manager)"
                  pattern: "^[a-z0-9-]+$"
                windowSeconds:
                  type: integer
                  description: "Deduplication window in seconds for this source. Events from this source within this window are considered duplicates."
                  minimum: 1
                  maximum: 31536000
                  default: 60
                enabled:
                  type: boolean
                  description: "Controls whether deduplication is enabled for this source (default: true)"
                  default: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Source
          type: string
          description: Target source for this dedup config
          jsonPath: .spec.targetSource
        - name: Window
          type: string
          description: Deduplication window
          jsonPath: .spec.windowSeconds
          priority: 1
        - name: Enabled
          type: boolean
          description: Whether dedup is enabled for this source
          jsonPath: .spec.enabled
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp

